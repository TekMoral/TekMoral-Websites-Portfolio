# Netlify configuration for high-performance Astro site
[build]
  command = "npm run build"
  publish = "dist"

# Redirects & URL rules
[[redirects]]
  from = "/index.html"
  to = "/"
  status = 301
  force = true

# Hashed assets - safe to cache aggressively
[[headers]]
  for = "/_astro/*"
  [headers.values]
    cache-control = "public, max-age=31536000, immutable"

# Static assets folder
[[headers]]
  for = "/assets/*"
  [headers.values]
    cache-control = "public, max-age=31536000, immutable"

# Images - cache for 1 week
[[headers]]
  for = "/**/*.png"
  [headers.values]
    cache-control = "public, max-age=604800"

[[headers]]
  for = "/**/*.jpg"
  [headers.values]
    cache-control = "public, max-age=604800"

[[headers]]
  for = "/**/*.jpeg"
  [headers.values]
    cache-control = "public, max-age=604800"

[[headers]]
  for = "/**/*.gif"
  [headers.values]
    cache-control = "public, max-age=604800"

[[headers]]
  for = "/**/*.webp"
  [headers.values]
    cache-control = "public, max-age=604800"

[[headers]]
  for = "/**/*.svg"
  [headers.values]
    cache-control = "public, max-age=604800"

[[headers]]
  for = "/**/*.ico"
  [headers.values]
    cache-control = "public, max-age=604800"

# Fonts - cache for 1 month
[[headers]]
  for = "/**/*.woff"
  [headers.values]
    cache-control = "public, max-age=2592000"

[[headers]]
  for = "/**/*.woff2"
  [headers.values]
    cache-control = "public, max-age=2592000"

[[headers]]
  for = "/**/*.ttf"
  [headers.values]
    cache-control = "public, max-age=2592000"

[[headers]]
  for = "/**/*.eot"
  [headers.values]
    cache-control = "public, max-age=2592000"

[[headers]]
  for = "/**/*.otf"
  [headers.values]
    cache-control = "public, max-age=2592000"

# CSS and JS files - cache for 1 day
[[headers]]
  for = "/**/*.css"
  [headers.values]
    cache-control = "public, max-age=86400"

[[headers]]
  for = "/**/*.js"
  [headers.values]
    cache-control = "public, max-age=86400"

[[headers]]
  for = "/**/*.mjs"
  [headers.values]
    cache-control = "public, max-age=86400"

# Text files - cache for 1 hour
[[headers]]
  for = "/**/*.txt"
  [headers.values]
    cache-control = "public, max-age=3600"

[[headers]]
  for = "/**/*.xml"
  [headers.values]
    cache-control = "public, max-age=3600"

[[headers]]
  for = "/**/*.json"
  [headers.values]
    cache-control = "public, max-age=3600"

# HTML pages - CDN cache aggressively, browser cache briefly
[[headers]]
  for = "*.html"
  [headers.values]
    cache-control = "public, max-age=300, s-maxage=86400, stale-while-revalidate=60"

# Root pages - same as HTML
[[headers]]
  for = "/"
  [headers.values]
    cache-control = "public, max-age=300, s-maxage=86400, stale-while-revalidate=60"

# All pages - security headers and fallback caching
[[headers]]
  for = "/*"
  [headers.values]
    cache-control = "public, max-age=300, s-maxage=86400, stale-while-revalidate=60"
    x-frame-options = "SAMEORIGIN"
    x-content-type-options = "nosniff"
    referrer-policy = "strict-origin-when-cross-origin"
    permissions-policy = "geolocation=(), microphone=(), camera=()"