# Netlify configuration for high-performance Astro site
[build]
  command = "npm run build"
  publish = "dist"

# Redirects & URL rules
[[redirects]]
  from = "/index.html"
  to = "/"
  status = 301
  force = true

# Hashed assets - safe to cache aggressively
[[headers]]
  for = "/_astro/*"
  [headers.values]
    cache-control = "public, max-age=31536000, immutable"

# Static assets folder
[[headers]]
  for = "/assets/*"
  [headers.values]
    cache-control = "public, max-age=31536000, immutable"

# Images - cache for 1 week
[[headers]]
  for = "*.{png,jpg,jpeg,gif,webp,svg,ico}"
  [headers.values]
    cache-control = "public, max-age=604800"

# Fonts - cache for 1 month
[[headers]]
  for = "*.{woff,woff2,ttf,eot,otf}"
  [headers.values]
    cache-control = "public, max-age=2592000"

# CSS and JS files - cache for 1 day
[[headers]]
  for = "*.{css,js,mjs}"
  [headers.values]
    cache-control = "public, max-age=86400"

# Text files - cache for 1 hour
[[headers]]
  for = "*.{txt,xml,json}"
  [headers.values]
    cache-control = "public, max-age=3600"

# HTML pages - CDN cache aggressively, browser cache briefly
[[headers]]
  for = "*.html"
  [headers.values]
    cache-control = "public, max-age=300, s-maxage=86400, stale-while-revalidate=60"

# Root pages - same as HTML
[[headers]]
  for = "/"
  [headers.values]
    cache-control = "public, max-age=300, s-maxage=86400, stale-while-revalidate=60"

# All pages - security headers and fallback caching
[[headers]]
  for = "/*"
  [headers.values]
    cache-control = "public, max-age=300, s-maxage=86400, stale-while-revalidate=60"
    x-frame-options = "SAMEORIGIN"
    x-content-type-options = "nosniff"
    referrer-policy = "strict-origin-when-cross-origin"
    permissions-policy = "geolocation=(), microphone=(), camera=()"